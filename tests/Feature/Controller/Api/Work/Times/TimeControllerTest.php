<?php

namespace Tests\Feature\Controller\Api\Work\Times;

use App\Models\Work\Time;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Support\Facades\Storage;
use Tests\TestCase;

class TimeControllerTest extends TestCase
{
    /**
     * @test
     */
    public function it_can_store_models()
    {
        $this->withoutExceptionHandling();

        $filename = 'betriko_arbeitszeit.csv';

        $base64encodedCsv = base64_encode(Storage::get($filename));
        // $base64encodedCsv = "NjgwMDs4OzIwMjAtMDEtMDIgMDM6NDU6MDA7MjAyMC0wMS0wMiAwNzo0NjoyMzswLjAwOzA7MDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo2ODA4Ozg7MjAyMC0wMS0wMiAwOTowOTo0MjsyMDIwLTAxLTAyIDE1OjMwOjE1OzAuNTA7MDsxOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwCjY4MTE7ODsyMDIwLTAxLTAzIDAzOjQ1OjAwOzIwMjAtMDEtMDMgMDc6NDU6MDA7MC4wMDswOzA7MDAwMC0wMC0wMCAwMDowMDowMDsyMDIwLTAxLTAzIDE1OjI4OjI4OzAwMDAtMDAtMDAgMDA6MDA6MDAKNjgxOTs4OzIwMjAtMDEtMDMgMDk6MTI6MjM7MjAyMC0wMS0wMyAxNTozMjo0MjsxLjAwOzA7MTswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo2ODI5Ozg7MjAyMC0wMS0wNiAwMzo0NTowMDsyMDIwLTAxLTA2IDA3OjQ2OjQwOzAuMDA7MDswOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwCjY4Mzk7ODsyMDIwLTAxLTA2IDA5OjEwOjQ5OzIwMjAtMDEtMDYgMTU6MjY6Mzg7MC41MDswOzE7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDAKNjg0NTs4OzIwMjAtMDEtMDcgMDM6NDU6MDE7MjAyMC0wMS0wNyAwNzo0NzoyNTswLjAwOzA7MDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo2ODU1Ozg7MjAyMC0wMS0wNyAwOTowOTo0MDsyMDIwLTAxLTA3IDE0OjQzOjQyOzAuMjU7MDswOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwCjY4NjE7ODsyMDIwLTAxLTA4IDAzOjQ1OjAxOzIwMjAtMDEtMDggMDc6NTQ6MTY7MC4wMDswOzA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDAKNjg3MTs4OzIwMjAtMDEtMDggMDk6MDg6MjA7MjAyMC0wMS0wOCAxNDo0OTowMzswLjI1OzA7MDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo2ODc0Ozg7MjAyMC0wMS0wOSAwMzo0NTowMDsyMDIwLTAxLTA5IDA3OjQ2OjQ1OzAuMDA7MDswOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwCjY4ODU7ODsyMDIwLTAxLTA5IDA5OjA5OjQ1OzIwMjAtMDEtMDkgMTQ6NTI6MjE7MC4yNTswOzA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDAKNjg5MDs4OzIwMjAtMDEtMTAgMDM6NDU6MDE7MjAyMC0wMS0xMCAwNzo0Njo1MTswLjAwOzA7MDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo2ODk4Ozg7MjAyMC0wMS0xMCAwOTowNzozNDsyMDIwLTAxLTEwIDE1OjMxOjU5OzAuMjU7MDsxOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwCjY5MDg7ODsyMDIwLTAxLTEzIDAzOjQ1OjAwOzIwMjAtMDEtMTMgMDc6NDk6MDI7MC4wMDswOzA7MDAwMC0wMC0wMCAwMDowMDowMDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDAKNjkxODs4OzIwMjAtMDEtMTMgMDk6MDk6NTY7MDAwMC0wMC0wMCAwMDowMDowMDswLjAwOzA7MDswMDAwLTAwLTAwIDAwOjAwOjAwOzAwMDAtMDAtMDAgMDA6MDA6MDA7MDAwMC0wMC0wMCAwMDowMDowMAo=";

        $this->assertCount(0, Time::all());

        $response = $this->post('api/work/time', [
            'api_token' => $this->user->api_token,
            'csv' => $base64encodedCsv,
        ]);

        $this->greaterThan(0, Time::count());
    }
}
